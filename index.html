<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Jeu des rues de Marseille</title>

  <!-- Google Fonts : Montserrat (titres), Nunito (texte) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;800&family=Nunito:wght@400;600&display=swap"
    rel="stylesheet"
  >

  <link rel="stylesheet" href="style.css">

  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  >
</head>

<body data-supabase-url="" data-supabase-anon-key="">
  <div id="app">
    <div id="sidebar">
      <!-- WRAPPER UNIQUE POUR DÉCALER TOUT LE CONTENU EN MOBILE -->
      <div id="sidebar-content">
        <!-- Bandeau titre -->
        <header class="panel header-panel">
          <div class="header-main">
      <h1 class="header-title">Camino</h1>
      <p class="header-subtitle">Connaissez-vous vraiment votre ville ?</p>
          </div>

          <!-- Petit statut carte, particulièrement utile sur mobile -->
          <div id="map-status" class="map-status-pill">
            <!-- rempli par le JS -->
          </div>
        </header>

        <!-- Panneau profil / auth repliable -->
        <section class="panel user-panel">
          <details>
            <summary class="panel-title">Profil</summary>

            <div class="info-block">
              <div id="current-user-label" class="info-label">Non connecté.</div>
            </div>

            <div class="info-block auth-block">
              <input id="auth-email" type="email" placeholder="Email">
              <input id="auth-username" type="text" placeholder="Pseudo">
              <input id="auth-password" type="password" placeholder="Mot de passe">
              <div class="auth-buttons">
                <button id="login-btn" class="btn-secondary">Connexion</button>
                <button id="register-btn" class="btn-secondary">Inscription</button>
                <button id="logout-btn" class="btn-tertiary" style="display:none;">Déconnexion</button>
              </div>
            </div>
          </details>
        </section>

        <!-- Panneau paramètres -->
        <section class="panel panel-params">
          <div class="panel-title">Paramètres</div>

          <div class="info-block">
            <label>Zone de jeu :</label>

            <div id="mode-select-wrapper" class="custom-select">
              <!-- Affichage sélectionné -->
              <button id="mode-select-button" class="custom-select-button">
                <span class="custom-select-label">Rues principales</span>
                <span class="difficulty-pill difficulty-pill--easy">Facile</span>
              </button>

              <!-- Liste déroulante -->
              <ul id="mode-select-list" class="custom-select-list">
                <li data-value="rues-celebres">
                  Rues célèbres
                  <span class="difficulty-pill difficulty-pill--easy">Très facile</span>
                </li>

                <li data-value="rues-principales">
                  Rues principales
                  <span class="difficulty-pill difficulty-pill--easy">Facile</span>
                </li>

                <li data-value="quartier">
                  Par quartier
                  <span class="difficulty-pill difficulty-pill--medium">Faisable</span>
                </li>

                <li data-value="ville">
                  Ville entière
                  <span class="difficulty-pill difficulty-pill--hard">Difficile</span>
                </li>

                <li data-value="monuments">
                  Monuments
                  <span class="difficulty-pill difficulty-pill--medium">Faisable</span>
                </li>
              </ul>
            </div>
          </div>

          <!-- Vrai select caché, piloté par le custom select, utilisé par le JS -->
          <select id="mode-select" class="hidden">
            <option value="rues-celebres">Rues célèbres</option>
            <option value="rues-principales" selected>Rues principales</option>
            <option value="quartier">Par quartier</option>
            <option value="ville">Ville entière</option>
            <option value="monuments">Monuments</option>
          </select>

          <div class="info-block" id="quartier-block" style="display:none;">
            <label for="quartier-select">Quartier :</label>

            <!-- Faux select stylé pour les quartiers (PAS de pastille) -->
            <div id="quartier-select-wrapper" class="custom-select">
              <!-- Affichage sélectionné -->
              <button id="quartier-select-button" class="custom-select-button">
                <span class="custom-select-label">Choisissez un quartier</span>
              </button>

              <!-- Liste déroulante remplie par le JS -->
              <ul id="quartier-select-list" class="custom-select-list"></ul>
            </div>

            <!-- Vrai select caché, utilisé par le JS existant -->
            <select id="quartier-select" class="hidden"></select>
          </div>

          <div class="info-block">
            <label>Type de partie :</label>

            <!-- Faux select stylé -->
            <div id="game-mode-select-wrapper" class="custom-select">
              <!-- Affichage sélectionné -->
              <button id="game-mode-select-button" class="custom-select-button">
                <span class="custom-select-label">Classique</span>
                <span class="difficulty-pill gamepill--classique" id="game-mode-pill">
                  20 rues
                </span>
              </button>

              <!-- Liste déroulante -->
              <ul id="game-mode-select-list" class="custom-select-list">
                <li data-value="classique">
                  Classique
                  <span class="difficulty-pill gamepill--classique">20 rues</span>
                </li>

                <li data-value="marathon">
                  Marathon
                  <span class="difficulty-pill gamepill--marathon">3 erreurs max</span>
                </li>

                <li data-value="chrono">
                  Mode chrono
                  <span class="difficulty-pill gamepill--chrono">1 minute</span>
                </li>

                <li data-value="lecture">
                  Lecture
                  <span class="difficulty-pill gamepill--lecture">Apprentissage</span>
                </li>

                <li data-value="daily">
                  Daily
                  <span class="difficulty-pill gamepill--daily">1 rue / jour</span>
                </li>
              </ul>
            </div>

            <!-- Vrai select caché, utilisé par le JS existant -->
            <select id="game-mode-select" class="hidden">
              <option value="classique" selected>Classique</option>
              <option value="marathon">Marathon</option>
              <option value="chrono">Mode Chrono</option>
              <option value="lecture">Lecture</option>
              <option value="daily">Daily</option>
            </select>
          </div>

          <div class="actions-row">
            <button id="restart-btn" class="btn-primary">Commencer la session</button>
            <button id="skip-btn" class="btn-skip" style="display:none;">Passer</button>
            <button id="pause-btn" class="btn-secondary">Pause</button>
          </div>
        </section>

      <!-- Panneau Rue à trouver -->
      <section class="panel target-panel">
        <div id="target-panel-title" class="panel-title">Rue à trouver</div>
        <div id="target-street" class="target-name">—</div>
      </section>

      <!-- Panneau Daily -->
      <section id="daily-panel" class="panel daily-panel hidden">
        <div class="panel-title">Daily</div>
        <div class="daily-status" id="daily-status">Connectez-vous pour jouer.</div>
        <div class="daily-attempts" id="daily-attempts">Tentatives restantes : —</div>
        <div class="daily-result" id="daily-result"></div>
      </section>

      <!-- Panneau infos rue principale -->
        <section id="street-info-panel" class="panel info-panel">
          <div class="panel-title">Infos rue principale</div>
          <div id="street-info" class="street-info"></div>
        </section>

        <!-- Panneau performance : chronos + score -->
  <section class="panel stats-panel">
    <div class="panel-title">Performance</div>

    <div class="stats-grid">
      <div class="stats-column stats-column--timers">
        <div class="stats-subtitle">⏱ Chronos</div>
        <div class="mobile-timer-label">Chrono</div>
        <div class="timers-row">
          <div class="timer-block">
            <div class="timer-label">Session</div>
            <div id="total-time" class="timer-value">0.0 s</div>
          </div>
          <div class="timer-block">
            <div class="timer-label">Rue</div>
            <div id="street-time" class="timer-value">0.0 s</div>
          </div>
        </div>
      </div>

      <div class="stats-column stats-column--score">
        <div class="stats-subtitle">★ Score</div>

        <div class="info-block score-block">
          <div class="info-label"></div>
          <div class="info-value">
            <span id="score-pill" class="score-pill score-pill--neutral">
              <span id="score">0 / 0 (0 %)</span>
            </span>
          </div>
        </div>

        <div class="info-block weighted-score-block">
          <div class="weighted-score-container">
            <div class="weighted-score-header">
              <span>Score pondéré</span>
              <span id="weighted-score" class="weighted-score">0.0</span>
            </div>

            <div class="weighted-score-progress" aria-hidden="true">
              <div
                id="weighted-score-bar"
                class="weighted-score-bar"
                style="width: 0%;"
              ></div>
            </div>

            <div class="weighted-score-meta">
              <small id="weighted-score-legend" class="weighted-score-legend">
                Le score s’affichera après votre première réponse.
              </small>

              <button
                id="weighted-score-help-btn"
                type="button"
                class="weighted-score-help-btn"
                aria-label="Information sur le score pondéré"
              >
                i
              </button>
            </div>

            <div id="weighted-score-help" class="weighted-score-help hidden">
              <strong>Score pondéré</strong><br>
              Chaque bonne réponse rapporte jusqu'à 10 points selon la rapidité : 1 point en moins par seconde. <br>
              Au-delà de 10 secondes, aucun point.<br><br>

              Le score affiché est la somme de tous les points de la session.
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

        <!-- Panneau stats publiques -->
        <section class="panel stats-public-panel" id="public-stats-panel">
          <div class="panel-title">Stats</div>
          <div class="info-block">
            <div class="info-label">Joueurs</div>
            <div class="info-value" id="stats-total-players">—</div>
          </div>
          <div class="info-block">
            <div class="info-label">Sessions</div>
            <div class="info-value" id="stats-total-sessions">—</div>
          </div>
          <div class="stats-breakdown" id="stats-breakdown">
            <div class="stats-breakdown-loading">Chargement des stats...</div>
          </div>
        </section>

        <!-- Panneau leaderboard -->
        <section class="panel leaderboard-panel" id="leaderboard-panel">
          <details open>
            <summary class="panel-title">Leaderboard</summary>

            <div id="leaderboard" class="leaderboard"></div>
          </details>
        </section>

        <section class="panel leaderboard-panel" id="daily-leaderboard-panel" style="display:none;">
          <details open>
            <summary class="panel-title">Daily leaderboard</summary>

            <div id="daily-leaderboard" class="leaderboard"></div>
          </details>
        </section>

        <!-- Panneau messages + récap -->
        <section class="panel panel-feedback">
          <div id="message" class="message"></div>
          <div id="summary" class="summary hidden"></div>
        </section>
      </div>
    </div>
    <div id="map"></div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script type="module" src="src/main.js"></script>
</body>
</html>
